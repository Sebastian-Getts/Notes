---
title: kafka
date: 2019-12-03 22:34:16
categories: Kafka
tags: kafka
---

一直听说卡夫卡，一直没搞明白过，，要把它撸顺咯，属于**大数据**的技术。
<!-- mroe -->

# 序
`分布式`的基于`发布、订阅`的`消息队列`（Message Queue)，主要应用于大数据实时处理领域。

## 消息队列
一个场景，用户注册某网站时填写个人信息，需要短信验证码，这时页面响应，有两种模式：
1. 同步：用户填写信息，提交（信息入库），触发短信发送接口，发送短信，页面反馈给用户
2. 异步：用户填写信息，提交（信息入库），页面反馈给用户，同时触发接口，发送短信

消息队列的主要特点：解耦、削峰

### 消息队列的两种模式

1. 点对点模式: 消费者主动拉取数据，消息收到后信息清除。消息生产者生产消息发送到Queue中，然后消息消费者从Queue中取出并且消费消息，消息被消费后Queue中不再有存储。。。。。Queue支持存在多个消费者，但是对一个消息而言，只会有一个消费者可以消费。
    消息不能复用，比如A生产消息，B消费消息，此时如果C也想消费A的消息，那么只能让A再开一个队列让C接受。`只是消息队列，不是消息的存储系统`（一对一）

2. 发布订阅模式：消费者消费数据后不会清除消息。相当于消息生产者将消息发布到topic中，同时有多个消息消费者（订阅）消费该消息。发布到topic的消息会被所有订阅者消费。（一对多）
   
    1. 队列主动推送
    2. 消费者主动拉取
    
    - 不想要的消息？？
    - 推送速度如何确定？
    
    而卡夫卡属于消费者拉取。所以卡夫卡内有个`长轮询`来不断地问topic内有没有消息。

## 基础架构

生产者、消费者、kafka集群。(集群就是消息暂停的地方)

1. 集群中，分布式，多台服务器。服务器中的broker就是卡夫卡的进程。broker中还有组件：主题。主题将消息分类。partition提高卡夫卡的负载能力和并发度。有leader和follower，后者做数据冗余，提升安全性，且前后者不会出现在同一台服务器。生产者只会寻找leader。主题：分区+主副本。
2. 消费者，有消费者组，将多个消费者用一个组名。`一个分区只能被一个消费者组内的某一个消费者消费`。消费者组可以提高消费能力。并发度最好的时候就是消费者个数与分支数相等。
3. zookeeper，集群要正常工作就要依赖zookeeper，要想多台装有卡夫卡的机器组成集群，只要他们所用的zookeeper是同一套集群就ok了。除了帮卡夫卡存贮信息外还存储消费到何处的位置信息。（0.9版本之前存才zk，之后存在kafka（存在磁盘，默认7天）。目的都一样：记住消费到的位置）

## 安装部署

